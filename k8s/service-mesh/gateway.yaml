apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: orion-gateway
  namespace: orion
  labels:
    app.kubernetes.io/name: orion-gateway
    app.kubernetes.io/component: ingress
    app.kubernetes.io/part-of: orion-platform
spec:
  selector:
    istio: ingressgateway # Use Istio default ingress gateway
  servers:
  # HTTP server (redirects to HTTPS)
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*.orion.example.com"
    - "orion.example.com"
    tls:
      httpsRedirect: true

  # HTTPS server
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - "*.orion.example.com"
    - "orion.example.com"
    tls:
      mode: SIMPLE
      credentialName: orion-tls-credential # TLS certificate from Kubernetes secret
      minProtocolVersion: TLSV1_2
      cipherSuites:
      - ECDHE-RSA-AES128-GCM-SHA256
      - ECDHE-RSA-AES256-GCM-SHA384
      - ECDHE-ECDSA-AES128-GCM-SHA256
      - ECDHE-ECDSA-AES256-GCM-SHA384

---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: orion-gateway-staging
  namespace: orion-staging
  labels:
    app.kubernetes.io/name: orion-gateway
    app.kubernetes.io/component: ingress
    app.kubernetes.io/part-of: orion-platform
    app.kubernetes.io/environment: staging
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*.staging.orion.example.com"
    - "staging.orion.example.com"
    tls:
      httpsRedirect: true

  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - "*.staging.orion.example.com"
    - "staging.orion.example.com"
    tls:
      mode: SIMPLE
      credentialName: orion-staging-tls-credential
      minProtocolVersion: TLSV1_2

---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: orion-gateway-production
  namespace: orion-prod
  labels:
    app.kubernetes.io/name: orion-gateway
    app.kubernetes.io/component: ingress
    app.kubernetes.io/part-of: orion-platform
    app.kubernetes.io/environment: production
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*.orion.example.com"
    - "orion.example.com"
    tls:
      httpsRedirect: true

  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - "*.orion.example.com"
    - "orion.example.com"
    tls:
      mode: SIMPLE
      credentialName: orion-prod-tls-credential
      minProtocolVersion: TLSV1_2
      cipherSuites:
      - ECDHE-RSA-AES128-GCM-SHA256
      - ECDHE-RSA-AES256-GCM-SHA384
      - ECDHE-ECDSA-AES128-GCM-SHA256
      - ECDHE-ECDSA-AES256-GCM-SHA384

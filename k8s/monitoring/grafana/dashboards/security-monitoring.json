{
  "title": "ORION Security Monitoring",
  "uid": "orion-security-monitoring",
  "tags": ["orion", "security", "auth"],
  "refresh": "30s",
  "panels": [
    {
      "id": 1,
      "title": "Failed Login Attempts",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
      "targets": [
        {"expr": "sum(increase(orion_auth_failed_attempts_total[1h]))"}
      ]
    },
    {
      "id": 2,
      "title": "Blocked IPs",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
      "targets": [
        {"expr": "count(orion_security_blocked_ips)"}
      ]
    },
    {
      "id": 3,
      "title": "Rate Limited Requests",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
      "targets": [
        {"expr": "sum(increase(http_server_requests_seconds_count{status=\"429\"}[1h]))"}
      ]
    },
    {
      "id": 4,
      "title": "Unauthorized Access (401)",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
      "targets": [
        {"expr": "sum(increase(http_server_requests_seconds_count{status=\"401\"}[1h]))"}
      ]
    },
    {
      "id": 5,
      "title": "Authentication Failures Over Time",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
      "targets": [
        {"expr": "sum(rate(orion_auth_failed_attempts_total[5m]))", "legendFormat": "Failed Attempts"}
      ]
    },
    {
      "id": 6,
      "title": "Login Success vs Failure",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
      "targets": [
        {"expr": "sum(rate(orion_user_logins_successful_total[5m]))", "legendFormat": "Successful"},
        {"expr": "sum(rate(orion_user_logins_failed_total[5m]))", "legendFormat": "Failed"}
      ]
    },
    {
      "id": 7,
      "title": "Top Failed Login IPs",
      "type": "table",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 12},
      "targets": [
        {"expr": "topk(20, sum by (ip) (increase(orion_auth_failed_attempts_total[1h])))", "format": "table", "instant": true}
      ]
    },
    {
      "id": 8,
      "title": "Suspicious Activity Patterns",
      "type": "table",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
      "targets": [
        {"expr": "sum by (user_id, activity_type) (orion_security_suspicious_activity)", "format": "table", "instant": true}
      ]
    },
    {
      "id": 9,
      "title": "JWT Token Validation Failures",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 20},
      "targets": [
        {"expr": "sum(rate(orion_jwt_validation_failures_total[5m]))", "legendFormat": "Token Validation Failures"}
      ]
    },
    {
      "id": 10,
      "title": "Security Events Log",
      "type": "logs",
      "datasource": "Loki",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20},
      "targets": [
        {"expr": "{namespace=\"orion\",service=~\".*auth.*\"} |= \"security\" or \"authentication\" or \"authorization\""}
      ]
    },
    {
      "id": 11,
      "title": "Permission Denied Events",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
      "targets": [
        {"expr": "sum(rate(http_server_requests_seconds_count{status=\"403\"}[5m]))", "legendFormat": "403 Forbidden"}
      ]
    },
    {
      "id": 12,
      "title": "API Key Usage",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
      "targets": [
        {"expr": "sum by (api_key_id) (rate(orion_api_key_requests_total[5m]))", "legendFormat": "{{api_key_id}}"}
      ]
    }
  ]
}
